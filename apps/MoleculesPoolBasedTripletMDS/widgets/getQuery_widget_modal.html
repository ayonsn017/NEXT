<style>
  html,body{
  height:100%;
  }

  div.container{
  height:100%;
  }

  #wrapper {
    height:85%;
  }

  div.row > div.col-xs-6 {
    height:100%;
    outline: 1px solid black;
  }

div.modal.in .modal-dialog {
        position:fixed;
        bottom:7%;
        right:20%;
        margin:fixed;
    }

/*div.modal.in .modal-dialog.modal {
  max-height: calc(100% - 100px);
  position: absolute;
    top: 50%;
    left: 50%;
  transform: translate(-100%, -100%);
}*/

  div.row > div.col-xs-12 {
    height:100%;
    outline: 1px solid black;
  }

  #wrapper > div.row {
    height:50%;
  }

  #wrapper img{
    max-height:100%;
    max-width:100%;
    height:auto;
  }

</style>
<div>
    Are the following two molecules the same?
    <p id="question_type">The type of question is {{ query.ques_type}}</p>
    <p id="same">The two molecules are {{ query.same }}</p>
</div>

<div class="row">
  <!-- Left Target -->
  <div class="col-xs-6" id="left">
    {% if query.target_indices[0].primary_type == "image" or query.target_indices[0].primary_type == "img"%}
    <img class="center-block" src={{ query.target_indices[0].primary_description }}></img>

    {% elif query.target_indices[0].primary_type == "text"%}
    <div>{{ query.target_indices[0].primary_description }}</div>

    {% elif query.target_indices[0].primary_type == "video" %}
    <video width="320" height="240" poster="http://jimpunk.net/Loading/wp-content/uploads/loading1.gif" controls autoplay loop>
      <source src={{ query.target_indices[0].primary_description }} type="video/mp4">
	Your browser does not support the video tag.
    </video>
    {% endif %}
  </div>

  <!-- Right Target -->
  <div class="col-xs-6" id="right">
    {% if query.target_indices[1].primary_type == "image" or query.target_indices[1].primary_type == "img" %}
    <img class="center-block" src={{ query.target_indices[1].primary_description }}> </img>
    {% elif query.target_indices[1].primary_type == "text" %}
    <div>{{ query.target_indices[1].primary_description }}</div>
    {% elif query.target_indices[0].primary_type == "video" %}
    <video width="320" height="240" poster="http://jimpunk.net/Loading/wp-content/uploads/loading1.gif" controls autoplay loop>
      <source src={{ query.target_indices[1].primary_description }} type="video/mp4">
	Your browser does not support the video tag.
    </video>
    {% endif %}
  </div>
</div>
</div>
    {% if query.ques_type == "training" %}
    <!-- provide feedback -->
    &nbsp;
    <button id="Yes" type="button" onclick="respond(this.id);">Yes</button>
    <button id="No" type="button" onclick="respond(this.id);">No</button>

    <!-- Make feedback modal appear --> 
    <div class="modal fade" id="modal_feedback" data-backdrop="static" data-keyboard="false " tabindex="-2" role="dialog" psoition="fixed" href="#">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="btn btn-danger"
                    data-dismiss="modal" onclick="submit_response()">Proceed</button>
          </div>
          <div class="modal-body">
            <h2 id="feedback_text">Feedback message</h2>
          <br>
          <div class="modal-footer">
          </div>
          </div>
        </div>
      </div>
    </div>

    {% else %}
    <!-- no feedback -->
    &nbsp;
    <button type="button" onclick="submit_yes()">Yes</button>
    <button type="button" onclick="submit_no()">No</button>
    {% endif %}
</div>


<script>

var response;
var feedback_message;
var respond = function(label){
    console.log('setting response variable')        

    // Disable buttons during feedback
    document.getElementById("Yes").disabled = true; 
    document.getElementById("No").disabled = true; 

    // Display modal with feedback
    response = (label === "Yes");
    generate_message({{ query.same }}, response);
    $('#modal_feedback').modal('show');
    $('h2#feedback_text').text(feedback_message);
}

var submit_response = function() {
    /* note: response variable always exists because the variable is assigned before modal
    displays, showing this button that calls this function*/ 
    if (response) {
        submit_yes()
    }
    else {
        submit_no()
    }
}

var generate_message = function(same, response){
    if (same && response){
        feedback_message = "Correct. The two molecules are the same.";
    }
    else if (!same && !response){
        feedback_message = "Correct. The two molecules are different.";
    }
    else if (!same && response){
        feedback_message = "Incorrect. The two molecules are different.";
    }
    else {
        feedback_message = "Incorrect. The two molecules are the same.";
    }
}

var submit_yes = function() {
    console.log('Submitting yes');
    next_widget.processAnswer({'target_winner': true, 'participant_uid': "{{ query.participant_uid }}"});    
}

var submit_no = function() {
    console.log('Submitting no');
    next_widget.processAnswer({'target_winner': false, 'participant_uid': "{{ query.participant_uid }}"});
}

</script>
</div>

